require 'benchmark'

def smallest_difference(array)
  nums = sort_io(array)
  find_the_smallest_diff(nums)
end

def sort_io(array)
  array.sort!
end

def find_the_smallest_diff(sorted_array)
  i = 0
  out = Array.new
  while i <= sorted_array.size - 2

    item_a = sorted_array[i]
    item_b = sorted_array[i + 1]
    res = item_b - item_a

    i += 1
    next if !out.empty? && out[1] - out[0] <= res

    out = [item_a, item_b]
  end
  out
end
p smallest_difference([-20, -3916237, -357920, -3620601, 7374819, -7330761, 30, 6246457, -6461594, 266854])
# => [-20, 30]
p smallest_difference([1000, -3916237, -357920, -3620601, 7374819, -7330761, 1003, 6246457, -6461594, 266854])
# [1000, 1003]
p smallest_difference([-5935536, -4857144, 8762611, -3710156, -62196, 5726532, 3880783, 8228893, 4557632, 8243459, 8058689, -2004515, -2532128, -2809277, 6230123, -1534444, 7594023, 8030804, -808395, 3895414, -1042916, -6349277, 8056932, 6449041, -5776338, -5663713, -2118668, -7889996, -7194680, 4072724, 5817742, 52723, -9978630, -4565272, -905845, 2413011, 6580118, 7342503, 9920829, 3264328, -2498614, -7173602, 9550646, -3508831, 6660598, 7160307, -1454798, -7810912, -6934054, 5412837, -3256366, 5648256, 7539528, 8948739, -9432879, 540367, -683895, -4837582, 404577, -7427248, 7493712, -7517462, 59838, 7493355, 2624635, 7528881, 4482783, 5371130, -7137887, 5776578, -4043963, -4861937, -5490722, -3065192, -1330264, -5049584, 8815653, -2956679, -3663308, 3294818, -3792431, -6884969, -6327570, -3304021, -7320937, -2754952, 5645257, 1616120, 2854718, 3721762, 9874605, 5629627, 5448934, 6511446, -4557691, 4035783, -4467467, 2150627, 6427050, 3916593])
# [7493355, 7493712]


# ========== MODEL SOLUTION ==========

def smallest_difference_model(array)
  numbers = [array[0], array[1]]
  min_dif = (array[0] - array[1]).abs

  array.each_with_index do |n1, i|
    array[(i + 1)..-1].each do |n2|
      diff = (n1 - n2).abs

      if min_dif > diff
        numbers = [n1, n2]
        min_dif = diff
      end
    end
  end

  [numbers.min, numbers.max]
end

# BENCHMARKING custom made solution vs model solution

hundred = [-5935536, -4857144, 8762611, -3710156, -62196, 5726532, 3880783, 8228893, 4557632, 8243459, 8058689, -2004515, -2532128, -2809277, 6230123, -1534444, 7594023, 8030804, -808395, 3895414, -1042916, -6349277, 8056932, 6449041, -5776338, -5663713, -2118668, -7889996, -7194680, 4072724, 5817742, 52723, -9978630, -4565272, -905845, 2413011, 6580118, 7342503, 9920829, 3264328, -2498614, -7173602, 9550646, -3508831, 6660598, 7160307, -1454798, -7810912, -6934054, 5412837, -3256366, 5648256, 7539528, 8948739, -9432879, 540367, -683895, -4837582, 404577, -7427248, 7493712, -7517462, 59838, 7493355, 2624635, 7528881, 4482783, 5371130, -7137887, 5776578, -4043963, -4861937, -5490722, -3065192, -1330264, -5049584, 8815653, -2956679, -3663308, 3294818, -3792431, -6884969, -6327570, -3304021, -7320937, -2754952, 5645257, 1616120, 2854718, 3721762, 9874605, 5629627, 5448934, 6511446, -4557691, 4035783, -4467467, 2150627, 6427050, 3916593]
n = 50000

Benchmark.bm(7) do |x|
  x.report("Custom:") { n.times { smallest_difference(hundred) }}
  x.report(" Model:") { n.times { smallest_difference_model(hundred) }}
end

# Results in seconds
#               user     system      total        real
# Custom:   1.966388   0.026945   1.993333 (  2.223805)
# Model :  25.665248   0.283568  25.948816 ( 27.136299)

